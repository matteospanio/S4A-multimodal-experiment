{% extends 'base.html.twig' %}

{% block title %}{{ task_name }} - S4A Experiment{% endblock %}

{% block body %}
<div class="container" data-controller="stimulus-selector">
    <div class="app-header">
        {% if task_type == 1 %}
            <p class="app-subtitle">{{ 'task.m2f.instructions'|trans }}</p>
        {% else %}
            <p class="app-subtitle">{{ 'task.f2m.instructions'|trans }}</p>
        {% endif %}
    </div>

    {{ form_start(form, {'action': path('app_task_submit', {'type': task_type, 'id': trial.id}), 'attr': {'id': 'trial-form'}}) }}
        {{ form_widget(form.choice, {'attr': {'data-stimulus-selector-target': 'choiceInput', 'style': 'display: none;'}}) }}
        <div class="row">
            <div class="col-md-12">
                {% if task_type == 1 %}
                    {# Task 1: Two audio stimuli + one perfume #}
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body text-center">
                                    <h4 class="card-title">Audio Stimuli</h4>

                                    <div class="audio-control">
                                        <h5>Audio Option A</h5>
                                        <audio controls preload="metadata">
                                            <source src="{{ trial.songs[0].url }}" type="audio/wav">
                                            {{ 'task.audio_error'|trans }}
                                        </audio>
                                    </div>

                                    <div class="audio-control">
                                        <h5>Audio Option B</h5>
                                        <audio controls preload="metadata">
                                            <source src="{{ trial.songs[1].url }}" type="audio/wav">
                                            {{ 'task.audio_error'|trans }}
                                        </audio>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body text-center">
                                    <h4 class="card-title">Perfume to Smell</h4>
                                    <div class="icon-lg text-primary mb-3">
                                        {{ trial.flavor.icon }}
                                    </div>
                                    <p class="card-text">Please smell the perfume sample provided</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-md-12">
                            <h4 class="text-center mb-3">{{ 'task.m2f.question'|trans }}</h4>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card stimulus-card"
                                         data-stimulus-selector-target="card"
                                         data-action="click->stimulus-selector#selectStimulus"
                                         id="{{ trial.songs[0].id }}">
                                        <div class="card-body text-center">
                                            <div class="icon-md text-primary">
                                                üéµ
                                            </div>
                                            <h5>{{ 'task.choose'|trans }} Audio A</h5>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card stimulus-card"
                                         data-stimulus-selector-target="card"
                                         data-action="click->stimulus-selector#selectStimulus"
                                         id="{{ trial.songs[1].id }}">
                                        <div class="card-body text-center">
                                            <div class="icon-md text-primary">
                                                üéµ
                                            </div>
                                            <h5>{{ 'task.choose'|trans }} Audio B</h5>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                {% else %}
                    {# Task 2: One audio stimulus + two perfume choices #}
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card mb-4">
                                <div class="card-body text-center">
                                    <h4 class="card-title">Audio Stimulus</h4>
                                    <div class="audio-control">
                                        <audio controls preload="metadata">
                                            <source src="{{ trial.song.url }}" type="audio/wav">
                                            {{ 'task.audio_error'|trans }}
                                        </audio>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <h4 class="text-center mb-3">{{ 'task.f2m.question'|trans }}</h4>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card stimulus-card"
                                         data-stimulus-selector-target="card"
                                         data-action="click->stimulus-selector#selectStimulus"
                                         id="{{ trial.flavors[0].id }}">
                                        <div class="card-body text-center">
                                            <div class="icon-md text-primary">
                                                {{ trial.flavors[0].icon }}
                                            </div>
                                            <h5>Perfume Option 1</h5>
                                            <p class="card-text">Smell the {{ trial.flavors[0] }} sample</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card stimulus-card"
                                         data-stimulus-selector-target="card"
                                         data-action="click->stimulus-selector#selectStimulus"
                                         id="{{ trial.flavors[1].id }}">
                                        <div class="card-body text-center">
                                            <div class="icon-md text-primary">
                                                {{ trial.flavors[1].icon }}
                                            </div>
                                            <h5>Perfume Option 2</h5>
                                            <p class="card-text">Smell the {{ trial.flavors[1] }} sample</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-12 text-center">
                <button class="btn btn-secondary me-3" type="button" onclick="window.history.back()">
                    ‚Üê {{ 'task.back'|trans }}
                </button>
                <button class="btn btn-primary" data-stimulus-selector-target="submitButton" type="submit" disabled>
                    {{ 'task.submit'|trans }} ‚Üí
                </button>
            </div>
        </div>
    {{ form_end(form) }}
</div>
{% endblock %}
