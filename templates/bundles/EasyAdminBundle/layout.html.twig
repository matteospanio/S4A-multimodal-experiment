{% extends '@!EasyAdmin/layout.html.twig' %}

{% block configured_javascripts %}
    {{ parent() }}
    {# Ensure Bootstrap is properly initialized in production mode #}
    <script>
        // Additional Bootstrap initialization for production mode
        document.addEventListener('DOMContentLoaded', function() {
            // Force initialization of any Bootstrap components that might not be auto-initialized
            if (typeof window.bootstrap !== 'undefined') {
                // Initialize tooltips
                const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new window.bootstrap.Tooltip(tooltipTriggerEl);
                });
                
                // Initialize popovers
                const popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
                popoverTriggerList.map(function (popoverTriggerEl) {
                    return new window.bootstrap.Popover(popoverTriggerEl);
                });
                
                // Additional specific initialization for EasyAdmin dropdowns
                const adminDropdowns = document.querySelectorAll('.dropdown-toggle, [data-bs-toggle="dropdown"]');
                adminDropdowns.forEach(function(dropdown) {
                    if (!window.bootstrap.Dropdown.getInstance(dropdown)) {
                        new window.bootstrap.Dropdown(dropdown);
                    }
                });
            }
            
            // Fallback: re-initialize on click if dropdown is not working
            document.addEventListener('click', function(e) {
                const dropdownToggle = e.target.closest('[data-bs-toggle="dropdown"]');
                if (dropdownToggle && typeof window.bootstrap !== 'undefined') {
                    const existingInstance = window.bootstrap.Dropdown.getInstance(dropdownToggle);
                    if (!existingInstance) {
                        try {
                            new window.bootstrap.Dropdown(dropdownToggle);
                        } catch (error) {
                            console.warn('Could not initialize dropdown on click:', error);
                        }
                    }
                }
            });
        });
    </script>
{% endblock %}